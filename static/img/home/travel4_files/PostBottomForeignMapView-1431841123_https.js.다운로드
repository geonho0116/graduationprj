var SimplePageNavigation=$Class({constant:{TOTALCOUNT_NONE:-1},$init:function(e,c,g,b,d,a,f){this._currentPage=Number(e)||1;this._totalCount=Number(c);this._countPerPage=Number(g)||20;this._existNextPage=b||false;this._alwaysPageView=d||false;this._existPrevPage=a||(e==1?false:true);this._lastPageViewType=Number(f)||1},getLastPageViewType:function(){return this._lastPageViewType},isAlwaysPageView:function(){return this._alwaysPageView},getCurrentPage:function(){return this._currentPage},isExistTotalCount:function(){return(this._totalCount>0)},getTotalCount:function(){return this._totalCount},getCountPerPage:function(){return this._countPerPage},getPrevPage:function(){return this.getCurrentPage()-1},getNextPage:function(){return this.getCurrentPage()+1},getTotalPageCount:function(){return parseInt(((this.getTotalCount()-1)/this.getCountPerPage())+1)},isLastPage:function(){if(this.isExistTotalCount()){return this.getTotalPageCount()<=this.getCurrentPage()}else{return this.getCurrentPage()>1&&!this._existNextPage}},isFirstPage:function(){return !this._existPrevPage},existNextPage:function(){return this._existNextPage},getElementCountUpToCurrentPageWithoutTotalCount:function(){var a=this.getCurrentPage()*this.getCountPerPage();return a},getElementCountUpToCurrentPage:function(){var a=this.getCurrentPage()*this.getCountPerPage();if(!this.isExistTotalCount()||a<this.getTotalCount()){return a}return this.getTotalCount()},getFirstElementInCurrentPage:function(){return(this.getCurrentPage()-1)*this.getCountPerPage()+1},getNextPageElementCount:function(){var a=this.getTotalCount()-this.getElementCountUpToCurrentPage();if(a>this.getCountPerPage()){return this.getCountPerPage()}return a},isFirstPageOnlyExist:function(){if(this.getTotalPageCount()==1){return true}if((this.getTotalCount()==this.constant.TOTALCOUNT_NONE)&&this.isFirstPage()&&(this.existNextPage()==false)){return true}return false}});var ForeignBlogPostMarker=classUtil.$LazyClass({currentPostDefaultZIndex:"1001",frontZIndex:"1002",$defineClass:function(a){return $Class(classUtil.extendPrototype(new google.maps.OverlayView(),a))},$lazyInit:function(g,a,f,d,c,e,h,i,b){this.position=g;this.xBaseOffset=f;this.yBaseOffset=d;this.nPostCount=c;this.baseZIndex=c>999?"1000":""+c;this.aLogNos=h;this.sImage=e;this.sLogNo=b;this.address=i;this.bIsCurrentPostMarker=$A(this.aLogNos).has(parseInt(this.sLogNo));this._map=a;this._div=null;this.setMap(a)},createDiv:function(){var b='{if nPostCount > 1}<div class="pin multy">{else}<div class="pin">{/if}<span class="thmb">{if sImage}<img src="{=sImage}" width=39 height=39 onerror="this.onerror=null;this.src=\'https://blogimgs.pstatic.net/nblog/mylog/mapview/thumb_empty.gif\'" >{else}<img src="https://blogimgs.pstatic.net/nblog/mylog/mapview/thumb_empty.gif" width=39 height=39>{/if}<span class="bl"></span>{if bIsCurrentPostMarker}<span class="now_spot">현재위치</span>{/if}</span>{if nPostCount > 999}<p class="count multiple"><strong><span>999+</span></strong></p>{elseif nPostCount > 9}<p class="count multiple"><strong><span>{=nPostCount}</span></strong></p>{elseif nPostCount > 1}<p class="count">{=nPostCount}</p>{/if}</div>';var a=$Template(b).process(this);var c=$Element("<div>");c.addClass("_nmap_marker");c.addClass("nmap_png");c.css("position","absolute");c.css("cursor","pointer");if(this.bIsCurrentPostMarker){c.css("zIndex",this.currentPostDefaultZIndex)}else{c.css("zIndex",this.baseZIndex)}c.html(a);return c},onAdd:function(){this._div=this.createDiv();var a=this;$Fn(function(c){google.maps.event.trigger(a,"click",c.$value(),a)}).attach(this._div,"click");$Fn(function(c){google.maps.event.trigger(a,"mouseover",c.$value(),a)}).attach(this._div,"mouseenter");$Fn(function(c){google.maps.event.trigger(a,"mouseout",c.$value(),a)}).attach(this._div,"mouseleave");var b=this.getPanes();b.overlayImage.appendChild(this._div.$value());this.setOffset()},setOffset:function(){this.xOffset=this._div.width()/2+this.xBaseOffset;this.yOffset=this._div.height()+this.yBaseOffset},draw:function(){var b=this.getProjection();var a=b.fromLatLngToDivPixel(this.position);this._div.css("left",(a.x-this.xOffset)+"px");this._div.css("top",(a.y-this.yOffset)+"px")},onRemove:function(){this._div.parent().remove(this._div);this._div=null},show:function(){this.setMap(this._map)},hide:function(){this.setMap(null)},setZIndex:function(a){this._div.css({zIndex:a})},setZIndexWhenMouseOut:function(){if(this.bIsCurrentPostMarker==true){this.setZIndex(this.currentPostDefaultZIndex)}else{this.setZIndex(this.baseZIndex)}},setZIndexWhenMouseOver:function(){this.setZIndex(this.frontZIndex)},getLogNos:function(){return this.aLogNos},getPosition:function(){return this.position},getAddress:function(){return this.address}});var ForeignBlogPostInfoPopup=classUtil.$LazyClass({$defineClass:function(a){return $Class(classUtil.extendPrototype(new google.maps.OverlayView(),a))},$lazyInit:function(a,d,e,b,c){this.yBaseOffset=b;this.xBaseOffset=e;this.position=a;this.sPostPreviewAreaHtml=c;this.createMarker=this.createDiv();this.map_=d;this.div_=null;this.setMap(d)},createDiv:function(){var a=document.createElement("div");a.innerHTML=this.sPostPreviewAreaHtml;a.style.cssText="position:absolute;z-index:1003;"+a.style.cssText;return a},onAdd:function(){var c=this.createMarker;var a=this;google.maps.event.addDomListener(c,"click",function(d){google.maps.event.trigger(a,"click",d,a)});google.maps.event.addDomListener(c,"mouseover",function(d){google.maps.event.trigger(a,"mouseover",d,a)});google.maps.event.addDomListener(c,"mouseout",function(d){google.maps.event.trigger(a,"mouseout",d,a)});var b=this.getPanes();b.overlayImage.appendChild(c);this.div_=c;this.setOffset();this.adjustMapCenter()},draw:function(){var b=this.getProjection();var a=b.fromLatLngToDivPixel(this.position);this.div_.style.left=(a.x-this.xOffset)+"px";this.div_.style.bottom=(-a.y+this.yBaseOffset)+"px"},setOffset:function(){this.xOffset=$Element(this.div_).width()/2+this.xBaseOffset;this.yOffset=$Element(this.div_).height()+this.yBaseOffset},adjustMapCenter:function(){var m=this.getProjection();var f=m.fromLatLngToDivPixel(this.position);var b=f.x-this.xOffset;var l=f.x+this.xOffset;var k=f.y-this.yOffset;var i=m.fromDivPixelToLatLng(new google.maps.Point(l,k));var c=m.fromDivPixelToLatLng(new google.maps.Point(b,k));var h=this.map_.getBounds().getNorthEast();var j=this.map_.getBounds().getSouthWest();var d=m.fromLatLngToDivPixel(j);var e=m.fromLatLngToDivPixel(h);var a=0;var g=0;if(b<(d.x+20)){a=d.x-b+20}else{if(l>(e.x-20)){a=e.x-l-20}}if(k<(e.y+20)){g=k-e.y-20}if(a==0&&g==0){return}this.offsetCenter(a,g)},offsetCenter:function(c,a){var f=this.map_;var g=Math.pow(2,f.getZoom());var e=f.getProjection().fromLatLngToPoint(f.getCenter());var d=new google.maps.Point((c/g)||0,(a/g)||0);var h=new google.maps.Point(e.x-d.x,e.y+d.y);var b=f.getProjection().fromPointToLatLng(h);f.panTo(b)},onRemove:function(){this.div_.parentNode.removeChild(this.div_);this.div_=null},show:function(){this.setMap(this.map_)},hide:function(){this.setMap(null)},setContents:function(a){this.div_.innerHTML=a;this.div_.style.cssText="position:absolute;z-index:1003;"+this.div_.style.cssText},getLogNos:function(){return this.aLogNos},getPosition:function(){return this.position}});var ForeignPostPreviewModel=$Class({$init:function(){this._sAddress="";this._aLogNos=[];this._aPostPreviewList=[];this._oPageNavigation=null;this._oPosition=null;this.ePostPreviewLoaded=new jsMVC.Event();this.ePostPreviewListLoaded=new jsMVC.Event()},$static:{COUNT_PER_PAGE:3},getEscapedAddress:function(){return this._sAddress},getPostPreviewList:function(){return this._aPostPreviewList},getPageNavigation:function(){return this._oPageNavigation},getPosition:function(){return this._oPosition},addEventListner:function(b,a){this._htEventListener.add(b,a)},loadPostPreview:function(c,a,b){this._aLogNos=c;this._sAddress=b;this._oPosition=a;this._fetchPostPreviewListFromServer($Fn(function(e){var d=this._destructPreviewList(e);if(d){this._aPostPreviewList=d}this.ePostPreviewLoaded.notify()},this).bind())},loadPreviewList:function(c,a,b){this._aLogNos=c;this._sAddress=b;this._oPosition=a;this._fetchPostPreviewListFromServer($Fn(function(e){var d=this._destructPreviewList(e);if(d){this._aPostPreviewList=d}this.ePostPreviewListLoaded.notify()},this).bind())},loadPreviewListByPage:function(a){this._fetchPostPreviewListFromServer($Fn(function(c){var b=this._destructPreviewList(c);if(b){this._aPostPreviewList=b}this.ePostPreviewListLoaded.notify()},this).bind(),a)},_fetchPostPreviewListFromServer:function(a,b){b=b||1;this._oPageNavigation=new SimplePageNavigation(b,this._aLogNos.length,ForeignPostPreviewModel.COUNT_PER_PAGE);var d="/mapview/PostListByLogNoAsync.nhn";var c={blogId:blogId,logNo:this._extractTargetLogNos(),latitude:this._oPosition.lat(),longitude:this._oPosition.lng()};var e=$Ajax(d,{method:"post",onerror:function(f){},onload:a});e.request(c)},_destructPreviewList:function(b){var a=b&&b.json();if(a==null||a.success!=true){return null}return a.postPreviewList},_extractTargetLogNos:function(){var c=this._oPageNavigation;var a=c.getFirstElementInCurrentPage()-1;var b=c.getElementCountUpToCurrentPage();return this._aLogNos.slice(a,b)}});var AbstractForeignPostPreviewView=$Class({$init:function(){this._initTemplate();this._mPostPreview=jsMVC.getModel("foreignMapViewController","foreignPostPreviewModel");this._infoPopupGenerator=jsMVC.getModel("foreignMapViewController","foreignMapViewModel").getInfoPopupGenerator();this._mPostPreview.ePostPreviewLoaded.attach($Fn(this._drawPostPreview,this).bind());this._mPostPreview.ePostPreviewListLoaded.attach($Fn(this._drawPostPreviewList,this).bind());this._oInfoWindow=null;this._htEventListener=$H({})},$static:{NCLICKS:{LIST:".list",PREVIEW:".preview"}},addEventListener:function(b,a){this._htEventListener.add(b,a)},clearInfoWindow:function(){if(this._oInfoWindow==null){return}this._oInfoWindow.hide();this._oInfoWindow=null},_initTemplate:function(){this.tplHtml=$Template('<div class="group_post">{=sPostPreviewTopHtml}<div class="post_container">{=sPostPreviewHtml}{=sPagingHtml}</div>{=sCloseButtonHtml}</div>');this.tplPostPreviewTopHtml=$Template('<h3><em class="tt">{=location} <span>{=postCountHtml}</span></em></h3>');this._sCloseButtonHtml='<a href="#" class="clse _closePostPreviewArea _returnFalse">닫기</a>';this.tplImageHtml=$Template('<img src="{=imageUrl}" width="{=width}" height="{=height}" alt=""/><span class="bl"></span>');this.tplPostPreviewListLi=$Template('<li><a href="{=postUrl}" class="thmb" {=targetWindow} onclick="clickcr(this, \'{=nclickCode}\', \'\', \'\', event)">{=imageHtml}</a><p><a href="{=postUrl}" {=targetWindow} onclick="clickcr(this, \'{=nclickCode}\', \'\', \'\', event)">{= title}</a></p><span class="post_cate">{= categoryName}</span><span class="time">{= addDate}</span></li>');this.tplPostPreviewList=$Template('<ul class="post_lst">{=sPostListHtml}</ul>');this.tplPostPreview=$Template("<h4><a href=\"{=postUrl}\" {=targetWindow} onclick=\"clickcr(this, '{=nclickCode}', '', '', event)\">{=title}</a></h4><p class=\"info\">{=categoryName} <span>{=addDate}</span></p><p class=\"dtl\"><a href=\"{=postUrl}\" {=targetWindow} onclick=\"clickcr(this, '{=nclickCode}', '', '', event)\">{=content}</a></p>{=thumbnailHtml}");this.tplPostThumbnailHtml=$Template("<li><a href=\"{=postUrl}\" class=\"thmb\" {=targetWindow} onclick=\"clickcr(this, '{=nclickCode}', '', '', event)\">{=imageHtml}</a></li>");this.tplPostUrl=$Template(blogURL+"{if isFromPostEndPage}/PostView.nhn{else}/GoPost.nhn{/if}?blogId={=blogId}&logNo={=logNo}");this.tplPagingHtml=$Template('<div class="btn"><span class="paging"><strong>{=getCurrentPage()}</strong><span>/</span>{=getTotalPageCount()}</span><a href="#" class="prev {if isFirstPage() }dsb{else}_goPreviewPage{/if} _returnFalse _param({=getPrevPage()})" >이전</a><a href="#" class="next {if isLastPage() }dsb{else}_goPreviewPage{/if} _returnFalse _param({=getNextPage()})" >다음</a></div>')},_drawPostPreview:function(){var d=this._mPostPreview.getPostPreviewList();var c=this._mPostPreview.getPageNavigation();var e=this._mPostPreview.getEscapedAddress();if(!d||d.length<1){return}var a=this._generatePostPreviewTopHtml(e,c.getTotalCount());var b=this._generatePostPreview(d,e);this._createInfoWindow(this.tplHtml.process({sPostPreviewTopHtml:a,sPostPreviewHtml:b,sCloseButtonHtml:this._sCloseButtonHtml,sPagingHtml:""}))},_drawPostPreviewList:function(){var d=this._mPostPreview.getPostPreviewList();var c=this._mPostPreview.getPageNavigation();var f=this._mPostPreview.getEscapedAddress();if(!d||d.length<1){return}var a=this._generatePostPreviewTopHtml(f,c.getTotalCount());var b=this._generatePostPreviewList(d,f);var e=this._generatePagingHtml(c);this._createInfoWindow(this.tplHtml.process({sPostPreviewTopHtml:a,sPostPreviewHtml:b,sCloseButtonHtml:this._sCloseButtonHtml,sPagingHtml:e}))},_registerEvent:function(){var a=this._oInfoWindow;if(a.lastEventListener){return}this._htEventListener.forEach(function(b,c){a.lastEventListener=google.maps.event.addListener(a,c,b)})},_createInfoWindow:function(b){var a=this._mPostPreview.getPosition();if(this._oInfoWindow==null||this._oInfoWindow.getPosition()!=a){this.clearInfoWindow();this._oInfoWindow=this._infoPopupGenerator(a,b);this._registerEvent()}else{this._oInfoWindow.setContents(b)}},_generatePagingHtml:function(a){if(a.getTotalCount()==1){return""}return this.tplPagingHtml.process(a)},_generatePostPreviewTopHtml:function(d,c){var b="";if(c>1){var a=c>999?"999+":c;b+="(<strong>"+a+"</strong>)"}return this.tplPostPreviewTopHtml.process({location:d,postCountHtml:b})},_generatePostPreviewList:function(b,c){var a="";$A(b).forEach($Fn(function(g,d,f){var e=this.tplPostPreviewListLi.process({postUrl:this._generatePostUrl(g.blogId,g.logNo),imageHtml:this._generateImageHtmlForList(g.thumbnailUrls,c,39,39),title:g.escapedTitle,addDate:g.addDate,categoryName:g.escapedCategoryName,targetWindow:this._TARGET_ATTR,nclickCode:this._NCLICK_PREFIX+AbstractForeignPostPreviewView.NCLICKS.LIST});a+=e},this).bind());return this.tplPostPreviewList.process({sPostListHtml:a})},_generatePostPreview:function(b,c){var a=b[0];var d=this.tplPostPreview.process({postUrl:this._generatePostUrl(a.blogId,a.logNo),title:a.escapedTitle,commentCountHtml:a.commentCount==0?" ":a.commentCount,addDate:a.addDateWithTime,categoryName:a.escapedCategoryName,thumbnailHtml:" ",content:a.escapedSummary,targetWindow:this._TARGET_ATTR,nclickCode:this._NCLICK_PREFIX+AbstractForeignPostPreviewView.NCLICKS.PREVIEW});d+=this._generatePostThumbnailHtml(a.blogId,a.logNo,c,a.thumbnailUrls);return d},_generatePostThumbnailHtml:function(e,a,c,d){if(d==null||d.length<1){return""}var b='<ul class="post_dtl">';$A(d).forEach($Fn(function(h,f,g){if(f==4){$A.Break()}b+=this.tplPostThumbnailHtml.process({postUrl:this._generatePostUrl(e,a),imageHtml:this._generateImageHtml(h,c,65,65),targetWindow:this._TARGET_ATTR,nclickCode:this._NCLICK_PREFIX+AbstractForeignPostPreviewView.NCLICKS.PREVIEW})},this).bind());b+="</ul>";return b},_generatePostUrl:function(b,a){return this.tplPostUrl.process({blogId:b,logNo:a,isFromPostEndPage:false})},_generateImageHtmlForList:function(d,c,b,a){if(d==null||d.length==0){return c}return this._generateImageHtml(d[0],c,b,a)},_generateImageHtml:function(c,d,b,a){if(c==null){return d}return this.tplImageHtml.process({imageUrl:c,width:b,height:a})}});var ForeignPostPreviewView=$Class({$init:function(){this._NCLICK_PREFIX="map_wld";this._TARGET_ATTR=' target="_blank" '}}).extend(AbstractForeignPostPreviewView);var ForeignPostPreviewEndView=$Class({$init:function(){this._NCLICK_PREFIX="mpv_wld";this._TARGET_ATTR=""}}).extend(AbstractForeignPostPreviewView);var AbstractForeignMapViewModel=$Class({$init:function(){this._oMap=null;this._aMarkerList=[];this._oMarkerCenter=null;this._nMarkerZoom=null;this._htMarkerListener=$H({});this._oCategory={categoryNo:0,parentCategoryNo:0};this.eMarkerChanged=new jsMVC.Event()},$static:{MAX_ZOOM_LEVEL:19,MIN_ZOOM_LEVEL:2},initMap:function(e,d,c,h){this._cleanUp();var b=this._getMapOptions();b.center=new google.maps.LatLng(d.lat,d.lng);b.zoom=c;var a=this._oMap=new google.maps.Map(e,b);var g=this._htMarkerListener;var f=$Class({addListener:function(j,i){google.maps.event.addListener(a,j,i)},addMarkerListener:function(j,i){g.add(j,i)}});if(h){this._oCategory=h}this.loadMarkers();return new f()},loadMarkers:function(){if(this._isNeedLoadMarkers()){this._oMarkerCenter=this._oMap.getCenter();this._nMarkerZoom=this._oMap.getZoom();var a=new $Ajax("/mapview/ClusteredPostForeignMarkerListAsync.nhn",{onload:$Fn(function(c,b){this._applyMarkers(c,b)},this).bind(this._nMarkerZoom),onerror:function(b){}}).request({blogId:blogId,scaleLevel:this._nMarkerZoom,latitude:this._oMarkerCenter.lat(),longitude:this._oMarkerCenter.lng(),categoryNo:this._oCategory.categoryNo,parentCategoryNo:this._oCategory.parentCategoryNo})}},loadCategory:function(a){this._oCategory={categoryNo:a,parentCategoryNo:0};new $Ajax("/mapview/ClusteredPostForeignMarkerListAsync.nhn",{onload:$Fn(function(b){this._resetViewPort(b)},this).bind(),onerror:function(b){}}).request({blogId:blogId,categoryNo:this._oCategory.categoryNo,parentCategoryNo:this._oCategory.parentCategoryNo})},loadParentCategory:function(a){this._oCategory={categoryNo:0,parentCategoryNo:a};new $Ajax("/mapview/ClusteredPostForeignMarkerListAsync.nhn",{onload:$Fn(function(b){this._resetViewPort(b)},this).bind(),onerror:function(b){}}).request({blogId:blogId,categoryNo:this._oCategory.categoryNo,parentCategoryNo:this._oCategory.parentCategoryNo})},isMaxZoomLevel:function(){return this._oMap.getZoom()>=AbstractForeignMapViewModel.MAX_ZOOM_LEVEL},getZoomLevel:function(){return this._oMap.getZoom()},getCenter:function(){return this._oMap.getCenter()},increaseZoomLevel:function(a){if(a){this._oMap.setCenter(a)}this._oMap.setZoom(this._oMap.getZoom()+1)},decreaseZoomLevel:function(){this._oMap.setZoom(this._oMap.getZoom()-1)},getInfoPopupGenerator:function(){return $Fn(function(a,b){return new ForeignBlogPostInfoPopup(a,this._oMap,0,52,b)},this).bind()},_getMapOptions:function(){return{}},_addMarkers:function(a){},_cleanUp:function(){this._oMap=null;this._aMarkerList=[];this._oMarkerCenter=null;this._nMarkerZoom=null;this._htMarkerListener=$H({})},_resetViewPort:function(d){var c=d&&d.json();if(!c){return}var b=this._oMarkerCenter=new google.maps.LatLng(c.latitude,c.longitude);var a=this._nMarkerZoom=c.scaleLevel;this._oMap.setCenter(b);this._oMap.setZoom(a);this._applyMarkers(this._oMap.getZoom(),d)},_isNeedLoadMarkers:function(){var a=111;var b=33000;var c=b/Math.pow(2,this._oMap.getZoom()-2)/a;if(!this._oMarkerCenter){return true}if(this._oMap.getZoom()!=this._nMarkerZoom){return true}if(this._oMap.getZoom()<4){return false}else{if(this._oMap.getCenter().lat()-this._oMarkerCenter.lat()>c||this._oMap.getCenter().lat()-this._oMarkerCenter.lat()<-c){return true}else{if(this._oMap.getCenter().lng()-this._oMarkerCenter.lng()>c||this._oMap.getCenter().lng()-this._oMarkerCenter.lng()<-c){return true}else{return false}}}},_applyMarkers:function(b,a){if(this._oMap.getZoom()!=b){return}if(a==null){return}var c=a.json();if(c==null||c.list==null){return}this._clearMarkers();this._addMarkers(c.list);this._setMarkersEvent();this.eMarkerChanged.notify()},_clearMarkers:function(){for(var a=0;a<this._aMarkerList.length;a++){this._aMarkerList[a].hide()}this._aMarkerList=[]},_setMarkersEvent:function(){$A(this._aMarkerList).forEach($Fn(function(a){this._htMarkerListener.forEach(function(b,c){google.maps.event.addListener(a,c,b)})},this).bind())}});var ForeignMapViewModel=$Class({_getMapOptions:function(){return{backgroundColor:"#A5BFDD",mapTypeId:google.maps.MapTypeId.ROADMAP,featureType:"road.local",elementType:"labels",draggableCursor:"default",mapTypeControl:false,disableDoubleClickZoom:true,panControl:false,streetViewControl:false,zoomControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT,style:google.maps.ZoomControlStyle.LARGE},scaleControl:true,scaleControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},minZoom:AbstractForeignMapViewModel.MIN_ZOOM_LEVEL,maxZoom:AbstractForeignMapViewModel.MAX_ZOOM_LEVEL}},_addMarkers:function(a){$A(a).reverse().forEach($Fn(function(f,b,e){var d=new google.maps.LatLng(f.latitude,f.longitude);var c=new ForeignBlogPostMarker(d,this._oMap,0,0,f.postCount,f.thumbnailUrl,f.logNos,f.address);this._aMarkerList.push(c)},this).bind())}}).extend(AbstractForeignMapViewModel);var ForeignPostMapViewModel=$Class({_getMapOptions:function(){return{backgroundColor:"#A5BFDD",mapTypeId:google.maps.MapTypeId.ROADMAP,featureType:"road.local",elementType:"labels",draggableCursor:"default",mapTypeControl:false,disableDoubleClickZoom:true,panControl:false,streetViewControl:false,zoomControl:false,scaleControl:true,scaleControlOptions:{position:google.maps.ControlPosition.RIGHT_BOTTOM},minZoom:AbstractForeignMapViewModel.MIN_ZOOM_LEVEL,maxZoom:AbstractForeignMapViewModel.MAX_ZOOM_LEVEL}},_addMarkers:function(a){$A(a).reverse().forEach($Fn(function(f,b,e){var d=new google.maps.LatLng(f.latitude,f.longitude);var c=new ForeignBlogPostMarker(d,this._oMap,0,0,f.postCount,f.thumbnailUrl,f.logNos,f.address,this.sLogNo);this._aMarkerList.push(c)},this).bind())},setLogNo:function(a){this.sLogNo=a}}).extend(AbstractForeignMapViewModel);var ForeignMiniZoomControl=$Class({$static:{_HTML:'<span class="btn_zoom"><a class="zin _zoomIn" href="#">Ȯ��</a><a class="zout _zoomOut" href="#">���</a></span>',_DISABLE_CLASSNAME:"dsb",MAX_ZOOM_LEVEL:19,MIN_ZOOM_LEVEL:2,Callback:$Class({onZoomIn:function(a){a.stop()},onZoomOut:function(a){a.stop()},getZoomLevel:function(){return 5}})},$init:function(a){this._oCallback=a||new ForeignMiniZoomControl.Callback()},create:function(a){this._elZoomControl=$(ForeignMiniZoomControl._HTML);a.append(this._elZoomControl);this._setEvents();this.refreshControl()},_setEvents:function(){this._welZoomIn=$Element($$.getSingle("._zoomIn",this._elZoomControl));this._welZoomOut=$Element($$.getSingle("._zoomOut",this._elZoomControl));$Fn(this._oCallback.onZoomIn,this).attach(this._welZoomIn,"click");$Fn(this._oCallback.onZoomOut,this).attach(this._welZoomOut,"click")},refreshControl:function(){var a=this._oCallback.getZoomLevel();if(a>=ForeignMiniZoomControl.MAX_ZOOM_LEVEL){this._welZoomIn.addClass(ForeignMiniZoomControl._DISABLE_CLASSNAME)}else{this._welZoomIn.removeClass(ForeignMiniZoomControl._DISABLE_CLASSNAME)}if(a<=ForeignMiniZoomControl.MIN_ZOOM_LEVEL){this._welZoomOut.addClass(ForeignMiniZoomControl._DISABLE_CLASSNAME)}else{this._welZoomOut.removeClass(ForeignMiniZoomControl._DISABLE_CLASSNAME)}}});var ForeignPostMapViewController=$Class({$jsMVC:jsMVC.$Controller,$init:function(){this._oMouseEnterMarker=null;this._sLogNo="";this._htLogNos=$H({})},$static:{DEFAULT_ZOOM_LEVEL:14,LAYER_PREFIX:"postmapview-",CANVAS_PREFIX:"postmapview-canvas-",GOOGLE_MAP_API:"//maps.google.co.kr/maps/api/js?sensor=false&v=3&client=gme-nhncorp&language=ko&channel=naver_blog"},start:function(){this._mMapView=jsMVC.getModel("foreignMapViewController","foreignMapViewModel");this._mPostPreview=jsMVC.getModel("foreignMapViewController","foreignPostPreviewModel");this._vPostPreview=jsMVC.getModel("foreignMapViewController","foreignPostPreviewView");this._setPreviewEvent();this._setMarkerChangedEvent()},showMapLazy:function(c,b,d,a){this._oInitCenter={lat:d,lng:a};this._sLogNo=b;if(typeof google=="undefined"||google==null||typeof google.maps=="undefined"||google.maps==null){loadUtil.loadScript(ForeignPostMapViewController.GOOGLE_MAP_API+"&callback=foreignPostMapViewController.showMap")}else{this.showMap()}},showMap:function(b){this._oWelCurrentMapLayer=$Element(ForeignPostMapViewController.LAYER_PREFIX+this._sLogNo);this._oWelCurrentMapLayer.show();var d=$(ForeignPostMapViewController.CANVAS_PREFIX+this._sLogNo);var a=$Element(d);a.css({width:"100%",height:"100%"});this._mMapView.setLogNo(this._sLogNo);var c=this._mMapView.initMap(d,this._oInitCenter,ForeignPostMapViewController.DEFAULT_ZOOM_LEVEL);this._setMapEvent(c);this._setMarkerEvent(c);this._initZoomControl(c,a);if(!this._htLogNos.hasKey(this._sLogNo)){$Fn(this._onControlClick,this).attach(this._oWelCurrentMapLayer,"click")}this._htLogNos.add(this._sLogNo,this._sLogNo)},_initZoomControl:function(d,c){var b=this._mMapView;var a=new ForeignMiniZoomControl({onZoomIn:function(e){b.increaseZoomLevel();e.stop()},onZoomOut:function(e){b.decreaseZoomLevel();e.stop()},getZoomLevel:function(){return b.getZoomLevel()}});a.create(c.parent());d.addListener("zoom_changed",$Fn(a.refreshControl,a).bind())},hideMap:function(){this._vPostPreview.clearInfoWindow();if(this._oWelCurrentMapLayer){this._oWelCurrentMapLayer.hide()}},_onControlClick:function(b){var a=$Element(b.element);if(a.hasClass("_close_mapview")){this.hideMap()}else{if(a.hasClass("_goto_mapview")){this._openBigMap()}}if(a.hasClass("_returnFalse")){b.stop()}},_openBigMap:function(){var d=this._mMapView.getCenter().lng();var c=this._mMapView.getCenter().lat();var a=this._mMapView.getZoomLevel();var b="/"+blogId+"?Redirect=mapview&latitude="+c+"&longitude="+d+"&zoomLevel="+a+"&mapRegionType=foreign";window.open(b)},_setMapEvent:function(a){var b=$Fn(this._mMapView.loadMarkers,this._mMapView).bind();a.addListener("center_changed",b);a.addListener("zoom_changed",b)},_setMarkerEvent:function(a){a.addMarkerListener("click",$Fn(this._onClickMarker,this).bind());a.addMarkerListener("mouseover",$Fn(this._onMouseOverMarker,this).bind());a.addMarkerListener("mouseout",$Fn(this._onMouseOutMarker,this).bind())},_setPreviewEvent:function(){this._vPostPreview.addEventListener("click",$Fn(this._onClickInfoWindow,this).bind())},_setMarkerChangedEvent:function(){this._mMapView.eMarkerChanged.attach($Fn(function(){this._oMouseEnterMarker=null;this._vPostPreview.clearInfoWindow()},this).bind())},_onClickMarker:function(c,a){clickcr($Event(c).element,"mpv_wld.pin","","",c);var b=a.getPosition();var d=a.getLogNos();if(this._isNeedToZoom(d)){this._mMapView.increaseZoomLevel(b);return}this._oMouseEnterMarker=a;this._mPostPreview.loadPostPreview(d,b,a.getAddress());this._oMouseEnterMarker=null},_onMouseOverMarker:function(b,a){if(a==this._oMouseEnterMarker){return}else{this._oMouseEnterMarker=a}a.setZIndexWhenMouseOver();$Fn(this._showPreviewList,this).delay(0.5,[this._mMapView.getZoomLevel(),a])},_onMouseOutMarker:function(b,a){if(this._oMouseEnterMarker==a){this._oMouseEnterMarker=null}a.setZIndexWhenMouseOut()},_showPreviewList:function(c,a){if(c!=this._mMapView.getZoomLevel()){return}if(this._oMouseEnterMarker!=a){return}var d=a.getLogNos();var b=a.getPosition();this._mPostPreview.loadPreviewList(d,b,a.getAddress())},_onClickInfoWindow:function(e,c){var b=$Event(e);var a=$Element(b.element);var d=utility.getParam(a.className());if(a.hasClass("_closePostPreviewArea")){this._oMouseEnterMarker=null;this._vPostPreview.clearInfoWindow()}else{if(a.hasClass("_goPreviewPage")){this._mPostPreview.loadPreviewListByPage(d[0])}}if(a.hasClass("_returnFalse")){b.stop()}},_isNeedToZoom:function(a){if(this._mMapView.isMaxZoomLevel()||a.length<=1){return false}return true}});jsMVC.setController("foreignMapViewController",ForeignPostMapViewController);jsMVC.setModel("foreignMapViewController","foreignMapViewModel",ForeignPostMapViewModel);jsMVC.setView("foreignMapViewController","foreignPostPreviewModel",ForeignPostPreviewModel);jsMVC.setView("foreignMapViewController","foreignPostPreviewView",ForeignPostPreviewEndView);var foreignPostMapViewController=jsMVC.getController("foreignMapViewController");foreignPostMapViewController.start();if(typeof(window.defineNHNJS)=="undefined"){window.defineNHNJS={}}window.defineNHNJS["PostBottomForeignMapView-1431841123_js"]=true;
