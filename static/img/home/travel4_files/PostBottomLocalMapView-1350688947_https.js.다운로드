BlogPostMarker=function(){if(typeof this.$init=="function"){this.$init.apply(this,arguments)}};BlogPostMarker.prototype={matchedClass:"nmap_overlay_pane",currentPostDefaultZIndex:"997",$init:function(c,a,e,k,b){this.nPostCount=a;this.aLogNos=k;this.sImage=e;this.baseZIndex=a>900?"900":""+a;this.sErrorImageUrl=imageURL+"/nblog/mylog/mapview/thumb_empty.gif";this._elEl=document.createElement("div");var d;if(this.nPostCount>1){d="<div class='pin multy'>"}else{d="<div class='pin'>"}d+='<span class="thmb">';if(this.sImage){d+="<img src='"+this.sImage+"' width=39 height=39 onerror=\"this.onerror=null;this.src='"+this.sErrorImageUrl+"'\" >"}else{d+="<img src='"+this.sErrorImageUrl+"' width=39 height=39>"}d+='<span class="bl"></span>';if(b!=null&&k!=null){for(var g=0;k.length>g;g++){if(k[g]==b){this.bIsCurrentPostMarker=true;d+='<span class="now_spot">현재위치</span>'}}}if(this.bIsCurrentPostMarker){this._elEl.style.cssText="z-index:"+this.currentPostDefaultZIndex+";"}else{this._elEl.style.cssText="z-index:"+this.baseZIndex+";"}d+="</span>";if(this.nPostCount>999){d+="<p class='count multiple'><strong><span>999+</span></strong></p>"}else{if(this.nPostCount>9){d+="<p class='count multiple'><strong><span>"+this.nPostCount+"</span></strong></p>"}else{if(this.nPostCount>1){d+="<p class='count'>"+this.nPostCount+"</p>"}}}d+="</div>";this._elEl.innerHTML=d;this._elEl.className="_nmap_marker nmap_png";this._elEl.style.cssText="position:absolute; cursor:pointer; _cursor:hand;"+this._elEl.style.cssText;this.setPoint(new nhn.api.map.LatLng(c.latitude,c.longitude));var j=new nhn.api.map.Size(43,49);var h=new nhn.api.map.Size(22,49);var f=new nhn.api.map.Icon(null,j,h);this.setIcon(f)},getLogNos:function(){return this.aLogNos}};nhn.mapcore.Util.extend(BlogPostMarker.prototype,nhn.api.map.Marker.prototype);nhn.mapcore.Util.extend(BlogPostMarker.prototype,nhn.api.map.MapObject.prototype);var PostPreviewModel=$Class({$init:function(){this._nCurrentPage=1;this._nCountPerPage=PostPreviewModel.LIST_COUNT_PER_PAGE;this._aTotalLogNos=[];this._sBlogId="";this._nLatitude=0;this._nLongitude=0;this._sViewType=PostPreviewModel.VIEW_TYPE.LIST;this._bIsFromPostEndPage=false;this.gotPreviewList=new jsMVC.Event()},$static:{VIEW_TYPE:{LIST:"list",PREVIEW:"preview"},LIST_COUNT_PER_PAGE:3,PREVIEW_COUNT_PER_PAGE:1,isListViewType:function(a){return a==PostPreviewModel.VIEW_TYPE.LIST},isPreviewType:function(a){return a==PostPreviewModel.VIEW_TYPE.PREVIEW}},setTotalLogNos:function(a){if(!a||typeof a!="object"||!(a instanceof Array)){this._aTotalLogNos=[]}this._aTotalLogNos=a},setBlogId:function(a){this._sBlogId=a},getBlogId:function(){return this._sBlogId},setLatitude:function(a){this._nLatitude=a},getLatitude:function(){return this._nLatitude},setLongitude:function(a){this._nLongitude=a},getLongitude:function(){return this._nLongitude},getTotalCount:function(){return this._aTotalLogNos.length},makeListViewType:function(){this._sViewType=PostPreviewModel.VIEW_TYPE.LIST;this._nCountPerPage=PostPreviewModel.LIST_COUNT_PER_PAGE},makePreviewType:function(){this._sViewType=PostPreviewModel.VIEW_TYPE.PREVIEW;this._nCountPerPage=PostPreviewModel.PREVIEW_COUNT_PER_PAGE},getViewType:function(){return this._sViewType},extractTargetLogNos:function(c){var a=(c-1)*this._nCountPerPage;var b=this._getTargetPageLastIndex(c);return this._aTotalLogNos.slice(a,b)},_getTargetPageLastIndex:function(a){if(a*this._nCountPerPage<this.getTotalCount()){return a*this._nCountPerPage}return this.getTotalCount()},isFirstPage:function(){return this._nCurrentPage==1},isLastPage:function(){return(this._nCurrentPage*this._nCountPerPage)>=this.getTotalCount()},getPreviousPage:function(){return this._nCurrentPage-1},setCurrentPage:function(a){this._nCurrentPage=a},getCurrentPage:function(){return this._nCurrentPage},getNextPage:function(){return this._nCurrentPage+1},getTotalPage:function(){return Math.floor((this.getTotalCount()-1)/this._nCountPerPage)+1},getPagingInfo:function(){var a={};a.previousPage=this.getPreviousPage();a.currentPage=this.getCurrentPage();a.totalPage=this.getTotalPage();a.nextPage=this.getNextPage();a.isFirstPage=this.isFirstPage();a.isLastPage=this.isLastPage();return a},_isExistPage:function(a){if(!a){return false}if(a<1||(a-1)*this._nCountPerPage>=this._aTotalLogNos.length){return false}return true},getDefaultPage:function(a){if(a==null||a<1||a>this.getTotalPage()){return 1}return a},isNotValidResponse:function(b){if(b==null){return true}var a=b.json();if(a==null||a.success!=true){return true}return false},makeFromPostEndPage:function(){this._bIsFromPostEndPage=true},isFromPostEndPage:function(){return this._bIsFromPostEndPage}});var PostPreviewView=$Class({$static:{NCLICKS:{MAP:{LARGE:"map",POST_END:"mpv"},APPROACH:{FIRST:"_dom",ADDITIONAL:"_dom"},PIN:".pin",LIST:".list",PREVIEW:".preview",FULLMAP:".fullmap"}},$init:function(){this.tplHtml=$Template('<div class="group_post">{=sPostPreviewTopHtml}<div class="post_container">{=sPostPreviewHtml}{=sPagingHtml}</div>{=sCloseButtonHtml}</div>');this.tplPostPreviewTopHtml=$Template("<h3>{=location} <span>{=postCountHtml}</span></h3>");this._sCloseButtonHtml='<a href="#" class="clse _closePostPreviewArea _returnFalse">닫기</a>';this.tplImageHtml=$Template('<img src="{=imageUrl}" width="{=width}" height="{=height}" alt=""/><span class="bl"></span>');this.tplPostPreviewListLi=$Template('<li><a href="{=postUrl}" class="thmb" {=targetWindow} onclick="clickcr(this, \'{=nclickCode}\', \'\', \'\', event)">{=imageHtml}</a><p><a href="{=postUrl}" {=targetWindow} onclick="clickcr(this, \'{=nclickCode}\', \'\', \'\', event)">{= title}</a></p><span class="post_cate">{= categoryName}</span><span class="time">{= addDate}</span></li>');this.tplPostPreviewList=$Template('<ul class="post_lst">{=sPostListHtml}</ul>');this.tplPostPreview=$Template("<h4><a href=\"{=postUrl}\" {=targetWindow} onclick=\"clickcr(this, '{=nclickCode}', '', '', event)\">{=title}</a></h4><p class=\"info\">{=categoryName} <span>{=addDate}</span></p><p class=\"dtl\"><a href=\"{=postUrl}\" {=targetWindow} onclick=\"clickcr(this, '{=nclickCode}', '', '', event)\">{=content}</a></p>{=thumbnailHtml}");this.tplPostThumbnailHtml=$Template("<li><a href=\"{=postUrl}\" class=\"thmb\" {=targetWindow} onclick=\"clickcr(this, '{=nclickCode}', '', '', event)\">{=imageHtml}</a></li>");this.tplPostUrl=$Template(blogURL+"{if isFromPostEndPage}/PostView.nhn{else}/GoPost.nhn{/if}?blogId={=blogId}&logNo={=logNo}");this.tplPagingHtml=$Template('<div class="btn"><span class="paging"><strong>{=currentPage}</strong><span>/</span>{=totalPage}</span><a href="#" class="prev {if isFirstPage }dsb{else}_goPreviewPage{/if} _returnFalse _param({=previousPage})" >이전</a><a href="#" class="next {if isLastPage }dsb{else}_goPreviewPage{/if} _returnFalse _param({=nextPage})" >다음</a></div>')},_generateTargetWindowAttribute:function(a){if(a==true){return""}return' target="_blank" '},generateResultView:function(c){if(!c||!c.aPostPreviewList||c.aPostPreviewList.length<1){return}var a=this._generatePostPreviewTopHtml(c.sEscapedAddress,c.nTotalCount);var b="";if(PostPreviewModel.isListViewType(c.sViewType)){b=this._generatePostPreviewList(c.aPostPreviewList,c.sEscapedAddress,c.bIsFromPostEndPage,c.bIsFirstApproach)}else{b=this._generatePostPreview(c.aPostPreviewList,c.sEscapedAddress,c.bIsFromPostEndPage,c.bIsFirstApproach)}var d=this._generatePagingHtml(c.oPagingInfo);return this.tplHtml.process({sPostPreviewTopHtml:a,sPostPreviewHtml:b,sCloseButtonHtml:this._sCloseButtonHtml,sPagingHtml:d})},_generatePostUrl:function(c,a,b){return this.tplPostUrl.process({blogId:c,logNo:a,isFromPostEndPage:b})},_generatePostPreviewTopHtml:function(d,c){var b="";if(c>1){var a=c>999?"999+":c;b+="(<strong>"+a+"</strong>)"}return this.tplPostPreviewTopHtml.process({location:d,postCountHtml:b})},_generatePostThumbnailHtml:function(g,a,d,f,e,c){if(f==null||f.length<1){return""}var b='<ul class="post_dtl">';$A(f).forEach($Fn(function(j,h,i){if(h==4){$A.Break()}b+=this.tplPostThumbnailHtml.process({postUrl:this._generatePostUrl(g,a,e),imageHtml:this._generateImageHtml(j,d,65,65),targetWindow:this._generateTargetWindowAttribute(e),nclickCode:(this.selectNClickCodePrefix(e,c)+PostPreviewView.NCLICKS.PREVIEW)})},this).bind());b+="</ul>";return b},_generatePostPreviewList:function(b,d,e,c){var a="";$A(b).forEach($Fn(function(i,f,h){var g=this.tplPostPreviewListLi.process({postUrl:this._generatePostUrl(i.blogId,i.logNo,e),imageHtml:this._generateImageHtmlForList(i.thumbnailUrls,d,39,39),title:i.escapedTitle,addDate:i.addDate,categoryName:i.escapedCategoryName,targetWindow:this._generateTargetWindowAttribute(e),nclickCode:(this.selectNClickCodePrefix(e,c)+PostPreviewView.NCLICKS.LIST)});a+=g},this).bind());return this.tplPostPreviewList.process({sPostListHtml:a})},selectNClickCodePrefix:function(d,c){var a=PostPreviewView.NCLICKS.MAP.LARGE;if(d==true){a=PostPreviewView.NCLICKS.MAP.POST_END}var b=PostPreviewView.NCLICKS.APPROACH.FIRST;if(c!=true){b=PostPreviewView.NCLICKS.APPROACH.ADDITIONAL}return(a+b)},_generatePostPreview:function(b,d,e,c){var a=b[0];var f=this.tplPostPreview.process({postUrl:this._generatePostUrl(a.blogId,a.logNo,e),title:a.escapedTitle,commentCountHtml:a.commentCount==0?" ":a.commentCount,addDate:a.addDateWithTime,categoryName:a.escapedCategoryName,thumbnailHtml:" ",content:a.escapedSummary,targetWindow:this._generateTargetWindowAttribute(e),nclickCode:(this.selectNClickCodePrefix(e,c)+PostPreviewView.NCLICKS.PREVIEW)});f+=this._generatePostThumbnailHtml(a.blogId,a.logNo,d,a.thumbnailUrls,e,c);return f},_generateImageHtmlForList:function(d,c,b,a){if(d==null||d.length==0){return c}return this._generateImageHtml(d[0],c,b,a)},_generateImageHtml:function(c,d,b,a){if(c==null){return d}return this.tplImageHtml.process({imageUrl:c,width:b,height:a})},_generatePagingHtml:function(a){if(a.totalPage==1){return""}return this.tplPagingHtml.process(a)}});var MapViewModel=$Class({$init:function(){this._oInfoWindowPoint=null;this._oMouseEnterMarker=null;this._nLevel=null;this._oCenter=null;this._nMarkerLevel=null;this._oMarkerCenter=null;this._bFirstApproach=true},setInfoWindowPoint:function(a){this._oInfoWindowPoint=a},getInfoWindowPoint:function(){return this._oInfoWindowPoint},setMouseEnterMarker:function(a){this._oMouseEnterMarker=a},delMouseEnterMarker:function(a){if(this._oMouseEnterMarker==a){this._oMouseEnterMarker=null}},getMouseEnterMarker:function(){return this._oMouseEnterMarker},setLevel:function(a){this._nLevel=a},getLevel:function(){return this._nLevel},setMarkerLevel:function(a){this._nMarkerLevel=a},getMarkerLevel:function(){return this._nMarkerLevel},setCenter:function(a,b){this._oCenter={x:a,y:b}},getCenter:function(){return this._oCenter},setMarkerCenter:function(a,b){this._oMarkerCenter={x:a,y:b}},getMarkerCenter:function(){return this._oMarkerCenter},changeApproachCount:function(){this._bFirstApproach=false},isFirstApproach:function(){return this._bFirstApproach}});var MapViewView=$Class({$init:function(){this._elContent=$("content-area");this._oMap=null;this._oInfoWindow=null;this._welMapArea=$Element($("mapArea"))},$static:{MAX_ZOOM_LEVEL:14,CLOSE_CSS_CLASS:"clse"},createMap:function(){this._oMap=new nhn.api.map.Map($("mapview-canvas"),{point:new nhn.api.map.LatLng(nDefaultLat,nDefaultLng),zoom:nDefaultLevel,enableWheelZoom:true,enableDragPan:true,enableDblClickZoom:false,mapMode:0,activateTrafficMap:false,activateBicycleMap:false,minMaxLevel:[1,14],size:new nhn.api.map.Size($Element("mapview-canvas").width(),660)});nhn.mapcore.Image.setEmptyTileUrl("https://ssl.pstatic.net/static/maps3/mapbg_pattern1.gif");var a=new nhn.api.map.ZoomControl();this._oMap.addControl(a);a.setPosition({top:10,right:10})},getMap:function(){return this._oMap},getContentArea:function(){return this._elContent},createInfoWindow:function(b,a){this.clearInfoWindow();this._oInfoWindow=new nhn.api.map.InfoWindow({enableBubbling:true});this._oInfoWindow.setVisible(false);this._oInfoWindow.setContent(b);this._oInfoWindow.setPoint(a);this._oInfoWindow.setPosition({right:"-145px",top:"49px"});this._oMap.addOverlay(this._oInfoWindow);this._oInfoWindow.setVisible(true);this._oInfoWindow.autoPosition()},addMarkers:function(a){$A(a).reverse().forEach($Fn(function(e,b,d){var c=new BlogPostMarker(e,e.postCount,e.thumbnailUrl,e.logNos);this.getMap().addOverlay(c)},this).bind())},clearInfoWindow:function(){if(this._oInfoWindow==null){return}this._oMap.removeOverlay(this._oInfoWindow)},isMaxZoomLevel:function(){return this._oMap.getLevel()>=MapViewView.MAX_ZOOM_LEVEL},increaseZoomLevel:function(a){this._oMap.setCenterAndLevel(a,this._oMap.getLevel()+1)},setCenterAndZoom:function(b,a){this._oMap.setCenterAndLevel(b,a)},toggleLeftArea:function(){if(this._welMapArea.hasClass(MapViewView.CLOSE_CSS_CLASS)){this._welMapArea.removeClass(MapViewView.CLOSE_CSS_CLASS);return}this._welMapArea.addClass(MapViewView.CLOSE_CSS_CLASS)},confirmSaveMyDefaultLocation:function(){return confirm("지도 첫 화면으로 설정하시겠습니까?\n설정 후 지도에 접속 시,\n현재 설정한 지역이 기본으로 보여집니다.")},showSaveMyDefaultLocationFailMessage:function(){alert("일시적인 오류로 설정에 실패했습니다. 다시 시도해주세요.")}});var MapViewController=$Class({$jsMVC:jsMVC.$Controller,$init:function(){this._oClipboard=null;this._oCategory={categoryNo:0,parentCategoryNo:0}},start:function(){this.vMapView=jsMVC.getView("mapViewController","mapViewView");this.mMapView=jsMVC.getModel("mapViewController","mapViewModel");this.mPostPreview=jsMVC.getModel("mapViewController","postPreviewModel");this.vPostPreview=jsMVC.getView("mapViewController","postPreviewView");this.vMapView.createMap();this._oCategory={categoryNo:nCategoryNo,parentCategoryNo:nParentCategoryNo};this._setEvent();this.mMapView.setLevel(this.vMapView.getMap().getLevel());this.mMapView.setCenter(this.vMapView.getMap().getCenter().x,this.vMapView.getMap().getCenter().y);this._showMarkers()},_setClipBoard:function(){if(utility.isSupportCopyCommand()){var a=utility.bSelectPrevent;utility.bSelectPrevent=true;var b=document.querySelector(".copyTargetUrl");$Element(b).show();b.select();document.execCommand("copy");$Element(b).hide();utility.bSelectPrevent=a;alert("이 글의 주소가 복사되었습니다.\n게시판이나 메신저 창에서 Ctrl+V를 눌러보세요.")}else{alert("지원하지 않는 브라우저입니다.")}},_setClipUrl:function(b){var e=mylogURL+"/"+blogId+"/map/l/"+b;var d=b>0?e:"";var f=document.querySelector(".copyTargetUrl");f.setAttribute("value",d);var c=$$.getSingle("._copyUrl");var a=$$.getSingle("._noCopyUrl");$Element(b>0?a:c).hide();$Element(b>0?c:a).show()},_onMouseMove:function(b){var a=this.vMapView.getMap().getLevel();this.mMapView.setLevel(a);this.mMapView.setCenter(this.vMapView.getMap().getCenter().x,this.vMapView.getMap().getCenter().y);this._showMarkers()},_onMouseEnter:function(b){var a=b.target;if(a instanceof BlogPostMarker){this.mMapView.setMouseEnterMarker(a);$Element(a.getElement()).css({zIndex:998});$Fn(this._showPostPreviewList,this).delay(0.5,[this.mMapView.getLevel(),a])}},_showPostPreviewList:function(c,a){if(c!=this.mMapView.getLevel()){return}if(this.mMapView.getMouseEnterMarker()!=a){return}var b=this.mMapView.getMouseEnterMarker().getPoint();this.mMapView.setInfoWindowPoint(b);var d=this._generateFetchingPostPreviewParameter(this.mMapView.getMouseEnterMarker().getLogNos(),blogId,b);this._fetchPostPreviewList(d)},_generateFetchingPostPreviewParameter:function(d,c,a){var b={};b.aLogNos=d;b.sBlogId=c;b.nLatitude=a.y;b.nLongitude=a.x;return b},_onMouseLeave:function(b){var a=b.target;if(a instanceof BlogPostMarker){this.mMapView.delMouseEnterMarker(a);if(a.bIsCurrentPostMarker==true){$Element(a.getElement()).css({zIndex:a.currentPostDefaultZIndex})}else{$Element(a.getElement()).css({zIndex:a.baseZIndex})}}},_onClickMap:function(c){var b=c.target;if(b instanceof BlogPostMarker){var e=b.getPoint();var g=b.getLogNos();var a=c.event;var d=this.vPostPreview.selectNClickCodePrefix(this.mPostPreview.isFromPostEndPage(),this.mMapView.isFirstApproach())+PostPreviewView.NCLICKS.PIN;clickcr(a.element,d,"","",a.$value());if(this._isNeedToZoom(g)){this.vMapView.increaseZoomLevel(e);return}this.mMapView.setMouseEnterMarker(b);this.mMapView.setInfoWindowPoint(e);var f=this._generateFetchingPostPreviewParameter(g,blogId,e);this._fetchPostPreview(f);this.mMapView.setMouseEnterMarker(null)}},_isNeedToZoom:function(a){if(this.vMapView.isMaxZoomLevel()||a.length<=1){return false}return true},_onZoom:function(a){this.mMapView.setLevel(this.vMapView.getMap().getLevel());this.mMapView.setCenter(this.vMapView.getMap().getCenter().x,this.vMapView.getMap().getCenter().y);this.mMapView.changeApproachCount();this._showMarkers()},_setEvent:function(){$Fn(this._doClick,this).attach(this.vMapView.getContentArea(),"click");var a=this.vMapView.getMap();a.attach("mouseenter",$Fn(this._onMouseEnter,this).bind());a.attach("mouseleave",$Fn(this._onMouseLeave,this).bind());a.attach("move",$Fn(this._onMouseMove,this).bind());a.attach("click",$Fn(this._onClickMap,this).bind());a.attach("zoom",$Fn(this._onZoom,this).bind())},_doClick:function(b){var c=b.element;var a=$Element(cssquery.getSingle("!a",c)?cssquery.getSingle("!a",c):c);var d=utility.getParam(a.className());if(a.hasClass("_goPreviewPage")){this._fetchPostPreviewListFromServer(d[0])}else{if(a.hasClass("_closePostPreviewArea")){this._closeInfoWindow()}else{if(a.hasClass("_toggleLeftArea")){this.vMapView.toggleLeftArea()}else{if(a.hasClass("_saveMyDefaultLocation")&&!oReadOnly.checkReadOnly(b)){this._saveMyDefaultLocation(b)}else{if(a.hasClass("_closeEventLayer")){this._closeEventLayer()}else{if(a.hasClass("_closeForeignEventLayer")){this._closeForeignEventLayer()}else{if(a.hasClass("_toggleCategory")){this._toggleCategory(b)}else{if(a.hasClass("_selectCategory")){this._checkCategory(d[0]);this._showCategory({categoryNo:d[0],parentCategoryNo:0});this._setClipUrl(d[0]);clickcr(b.element,"mca_dom.clist","","",b.$value())}else{if(a.hasClass("_copyUrl")){this._setClipBoard()}else{if(a.hasClass("_selectParentCategory")){this._checkCategory(d[0]);this._showCategory({categoryNo:0,parentCategoryNo:d[0]});this._setClipUrl(d[0]);clickcr(b.element,"mca_dom.clist","","",b.$value())}}}}}}}}}}if(a.hasClass("_returnFalse")){b.stop()}},_closeForeignEventLayer:function(){if($("check").checked){tripleSRequester.request("FMLO","true",function(a){},function(a){})}$Element("mapForeignEventLayer").css("display","none");$Element("mapForeignEventButton").css("display","block")},_closeEventLayer:function(){tripleSRequester.request("MLOPLO","true",function(a){},function(a){});$Element("mapEventLayer").hide()},_fetchPostPreview:function(a){this.mPostPreview.makePreviewType();this._populateSearchParameters(a);this._fetchPostPreviewListFromServer()},_fetchPostPreviewList:function(a){this.mPostPreview.makeListViewType();this._populateSearchParameters(a);this._fetchPostPreviewListFromServer()},_populateSearchParameters:function(a){this.mPostPreview.setTotalLogNos(a.aLogNos);this.mPostPreview.setBlogId(a.sBlogId);this.mPostPreview.setLatitude(a.nLatitude);this.mPostPreview.setLongitude(a.nLongitude)},_fetchPostPreviewListFromServer:function(a){a=this.mPostPreview.getDefaultPage(a);var c="/mapview/PostListByLogNoAsync.nhn";var b={blogId:this.mPostPreview.getBlogId(),logNo:this.mPostPreview.extractTargetLogNos(a),latitude:this.mPostPreview.getLatitude(),longitude:this.mPostPreview.getLongitude()};var d=$Ajax(c,{method:"post",onload:$Fn(this._drawResult,this).bind(a,this.mMapView.getLevel()),onerror:function(e){}});d.request(b)},_saveMyDefaultLocation:function(a){var b={blogId:blogId,mapRegionType:"local",zoomLevel:this.vMapView.getMap().getLevel(),latitude:this.vMapView.getMap().getCenter().y,longitude:this.vMapView.getMap().getCenter().x};clickcr(a.element,"map_dom.save","","",a.$value());if(this.vMapView.confirmSaveMyDefaultLocation()){clickcr(a.element,"dls.dsave","","",a.$value());$Ajax("/mapview/MyDefaultLocationSaveAsync.nhn",{method:"post",onload:$Fn(function(c){if(c.text()!=="true"){this.vMapView.showSaveMyDefaultLocationFailMessage()}},this).bind(),onerror:$Fn(function(c){this.vMapView.showSaveMyDefaultLocationFailMessage()},this).bind()}).request(b)}else{clickcr(a.element,"dls.dcancel","","",a.$value())}},_closeInfoWindow:function(){this.mMapView.setMouseEnterMarker(null);this.vMapView.clearInfoWindow()},_drawResult:function(a,f,d){if(this.mMapView.getLevel()!=f){return}if(this.mPostPreview.isNotValidResponse(d)){return}this.mPostPreview.setCurrentPage(parseInt(a));var c=d.json();var b={};b.aPostPreviewList=c.postPreviewList;b.sViewType=this.mPostPreview.getViewType();b.sEscapedAddress=c.escapedAddress;b.oPagingInfo=this.mPostPreview.getPagingInfo();b.nTotalCount=this.mPostPreview.getTotalCount();b.bIsFromPostEndPage=this.mPostPreview.isFromPostEndPage();b.bIsFirstApproach=this.mMapView.isFirstApproach();var e=this.vPostPreview.generateResultView(b);this.vMapView.createInfoWindow(e,this.mMapView.getInfoWindowPoint())},_showMarkers:function(){var d=this.mMapView.getLevel(),b=this.mMapView.getCenter();var a=this.mMapView.getMarkerLevel(),c=this.mMapView.getMarkerCenter();if(this._isNeedLoadMarkers(d,a,b,c)){this.mMapView.setMarkerLevel(d);this.mMapView.setMarkerCenter(b.x,b.y);var e=new $Ajax("/mapview/PostMarkerListAsync.nhn",{onload:$Fn(function(g,f){this._drawMarkers(g,f)},this).bind(d),onerror:function(f){}}).request({blogId:blogId,scaleLevel:d,latitude:b.y,longitude:b.x,categoryNo:this._oCategory.categoryNo,parentCategoryNo:this._oCategory.parentCategoryNo})}},_showCategory:function(a){this._oCategory=a;var b=new $Ajax("/mapview/PostMarkerListAsync.nhn",{onload:$Fn(this._resetViewPort,this).bind(),onerror:function(c){}}).request({blogId:blogId,categoryNo:this._oCategory.categoryNo,parentCategoryNo:this._oCategory.parentCategoryNo})},_resetViewPort:function(d){var c=d&&d.json();if(!c){return}var b=c.longitude;var e=c.latitude;var a=c.scaleLevel;this.mMapView.setMarkerCenter(b,e);this.mMapView.setMarkerLevel(a);this.mMapView.setCenter(b,e);this.mMapView.setLevel(a);var f=new nhn.api.map.LatLng(e,b);this.vMapView.setCenterAndZoom(f,a);this._drawMarkers(a,d)},_isNeedLoadMarkers:function(f,a,b,d){var c=111;var e=2000;var g=e/Math.pow(2,f-1)/c;if(!d){return true}if(f!=a){return true}if(f<4){return false}else{if(b.x-d.x>g||b.x-d.x<-g){return true}else{if(b.y-d.y>g||b.y-d.y<-g){return true}else{return false}}}},_drawMarkers:function(b,a){if(this.mMapView.getLevel()!=b){return}if(a==null){return}var c=a.json();if(c==null||c.list==null){return}this.mMapView.setMouseEnterMarker(null);this.vMapView.getMap().clearOverlay();this.vMapView.addMarkers(c.list)},_toggleCategory:function(a){var b=$Element($$.getSingle("._categoryBox"));if(b.hasClass("on")){b.removeClass("on");clickcr(a.element,"mca_dom.cfold","","",a.$value())}else{b.addClass("on");clickcr(a.element,"mca_dom.cunfold","","",a.$value())}},_checkCategory:function(a){$A($$("._categoryItem")).forEach(function(c){var b=$Element(c);b.removeClass("on");var d=utility.getParam(b.className());if(a==d[0]){b.addClass("on")}})}});var MiniZoomControl=function(d,b,c,g){var j="dsb";var a='<span class="btn_zoom"><a class="zin _zoomIn" href="#">확대</a><a class="zout _zoomOut" href="#">축소</a></span>';var i=new nhn.api.map.CustomControl();i.createControl(a);i.setPosition(b);var f=$Element($Element(i.getElement()).query("._zoomIn"));var h=$Element($Element(i.getElement()).query("._zoomOut"));var e=function(l){var k=d.getLevel();if(k==g){f.addClass(j)}else{if(k==c){h.addClass(j)}}if(h.hasClass(j)&&l&&l.fromLevel<l.toLevel){h.removeClass(j)}else{if(f.hasClass(j)&&l&&l.fromLevel>l.toLevel){f.removeClass(j)}}};d.attach("zoom",e);i.attachEvent("_zoomIn","click",function(k){k.stop();var l=$Element(k.element);var m=$Element(k.element).next();k.element.blur();if(l.hasClass(j)){return}d.setLevel(d.getLevel()+1)});i.attachEvent("_zoomOut","click",function(k){k.stop();var l=$Element(k.element).prev();var m=$Element(k.element);k.element.blur();if(m.hasClass(j)){return}d.setLevel(d.getLevel()-1)});e();return i};var PostMapViewView=$Class({$init:function(){this._oMaps={};this._oMap=null;this._oWelCurrentMapLayer=null},$static:{DEFAULT_ZOOM_LEVEL:9,LAYER_PREFIX:"postmapview-",CANVAS_PREFIX:"postmapview-canvas-"},getContentArea:function(){return this._oWelCurrentMapLayer.$value()},showMap:function(e,f,b,d,a){this._oWelCurrentMapLayer=$Element(PostMapViewView.LAYER_PREFIX+d);this._oWelCurrentMapLayer.show();this.currentLatLng=new nhn.api.map.LatLng(f,b);this.currentLogNo=d;var c=$Element(PostMapViewView.CANVAS_PREFIX+d);this._oMap=this._oMaps[d];if(this._oMap==null){this._oMap=new nhn.api.map.Map(c.$value(),{point:this.currentLatLng,zoom:PostMapViewView.DEFAULT_ZOOM_LEVEL,enableWheelZoom:true,enableDragPan:true,enableDblClickZoom:false,mapMode:0,activateTrafficMap:false,activateBicycleMap:false,minMaxLevel:[1,14],size:new nhn.api.map.Size(c.attr("width"),c.attr("height"))});nhn.mapcore.Image.setEmptyTileUrl("https://ssl.pstatic.net/static/maps3/mapbg_pattern1.gif");this._oMap.addControl(new MiniZoomControl(this._oMap,{top:56,right:13},1,14,PostMapViewView.DEFAULT_ZOOM_LEVEL));this._oMaps[d]=this._oMap;a()}else{this._oMap.setCenterAndLevel(this.currentLatLng,PostMapViewView.DEFAULT_ZOOM_LEVEL)}},hideMap:function(){if(this._oMap!=null){this.clearInfoWindow();this._oMap=null}if(this._oWelCurrentMapLayer){this._oWelCurrentMapLayer.hide()}},addMarkers:function(b){var a=this.currentLogNo;$A(b).reverse().forEach($Fn(function(f,c,e){var d=new BlogPostMarker(f,f.postCount,f.thumbnailUrl,f.logNos,a);this.getMap().addOverlay(d)},this).bind())}}).extend(MapViewView);var PostMapViewController=$Class({$init:function(){var a=$Element("<link>");if(window.location.protocol=="https:"){a.href="https://ssl.pstatic.net/static/maps/openapi_map/maps_openapi.css"}else{a.href="https://ssl.pstatic.net/static/openapi_map/maps_openapi.css"}a.attr({rel:"stylesheet",type:"text/css",});$Element(document.getElementsByTagName("head")[0]).append(a)},start:function(){this.vMapView=jsMVC.getView("postMapViewController","postMapViewView");this.mMapView=jsMVC.getModel("postMapViewController","mapViewModel");this.mPostPreview=jsMVC.getModel("postMapViewController","postPreviewModel");this.vPostPreview=jsMVC.getView("postMapViewController","postPreviewView");this.mPostPreview.makeFromPostEndPage()},showMap:function(c,b,d,a){this.vMapView.showMap(c,d,a,b,$Fn(this._setEvent,this).bind());this.mMapView.setLevel(this.vMapView.getMap().getLevel());this.mMapView.setCenter(this.vMapView.getMap().getCenter().x,this.vMapView.getMap().getCenter().y);this._showMarkers()},hideMap:function(){this.vMapView.hideMap()},goMapView:function(){var d=this.vMapView.getMap().getCenter().x;var c=this.vMapView.getMap().getCenter().y;var a=this.vMapView.getMap().getLevel();var b="/"+blogId+"?Redirect=mapview&latitude="+c+"&longitude="+d+"&zoomLevel="+a+"&mapRegionType=local";window.open(b)},_doClick:function(b){var c=b.element;var a=$Element(cssquery.getSingle("!a",c)?cssquery.getSingle("!a",c):c);var d=utility.getParam(a.className());if(a.hasClass("_goPreviewPage")){this._fetchPostPreviewListFromServer(d[0])}else{if(a.hasClass("_closePostPreviewArea")){this._closeInfoWindow()}else{if(a.hasClass("_goto_mapview")){a.$value().blur();this.goMapView()}else{if(a.hasClass("_close_mapview")){this.hideMap()}}}}if(a.hasClass("_returnFalse")){b.stop()}}}).extend(MapViewController);jsMVC.setController("postMapViewController",PostMapViewController);jsMVC.setView("postMapViewController","postMapViewView",PostMapViewView);jsMVC.setModel("postMapViewController","mapViewModel",MapViewModel);jsMVC.setModel("postMapViewController","postPreviewModel",PostPreviewModel);jsMVC.setView("postMapViewController","postPreviewView",PostPreviewView);var postMapViewController=jsMVC.getController("postMapViewController");postMapViewController.start();if(typeof(window.defineNHNJS)=="undefined"){window.defineNHNJS={}}window.defineNHNJS["PostBottomLocalMapView-1350688947_js"]=true;
